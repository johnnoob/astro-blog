---
// layout
import BaseLayout from "@/layouts/BaseLayout.astro";
// assets
import selfLaugh from "../images/self-laugh.png";
import selfNormal from "../images/self-normal.png";
import { Button } from "@/components/ui/button";
// react icons
import { FaCheck, FaX, FaLine } from "react-icons/fa6";
---

<BaseLayout pageTitle="é—œæ–¼æˆ‘">
  <section class="mb-11">
    <canvas id="confetti"></canvas>
    <div class="w-72 h-72 mx-auto">
      <img
        src={selfNormal.src}
        alt="self portrait normal"
        id="self-normal"
        class="w-full h-full object-cover"
      />
      <img
        src={selfLaugh.src}
        alt="self portrait happy"
        id="self-laugh"
        class="hidden w-full h-full object-cover"
      />
    </div>
    <div class="w-fit flex flex-col items-center mx-auto gap-5">
      <h1 class="text-4xl font-semibold tracking-wider">
        å“ˆå›‰ï¼Œæˆ‘å«<strong class="text-red-500">"è˜¿è””ğŸ¥•"</strong>
      </h1>
      <h2 class="text-3xl font-semibold">
        æˆ‘<span id="typewriter"></span><span id="cursor">|</span>
      </h2>
      <p class="text-lg text-center" id="introduction">
        æˆ‘æ˜¯å€‹å®…å®…å…¬å‹™å“¡ï¼Œèˆˆè¶£æ˜¯é€›è¡—ã€åƒç¾é£Ÿã€ç¨‹å¼è¨­è¨ˆã€çœ‹å‹•ç•«ã€æ‰“æ¡Œçƒï¼Œé¡˜æ„æ”¹å¤©å–å€‹å’–å•¡èªè­˜ä¸€ä¸‹å—ï¼Ÿ
      </p>
      <div class="grid gap-2 mt-2 hidden" id="agree-section">
        <div class="flex gap-2 items-center justify-center">
          <FaLine className="text-green-400" size={30} /><span
            class="text-xl font-semibold">johngenius</span
          >
        </div>
        <p class="text-lg">
          å‚™è¨»ï¼šå¦‚æœä¸æƒ³ä¾†å¾€ï¼Œè«‹ç›´æ¥å°‡æˆ‘<strong class="text-red-500"
            >å°é–</strong
          >ï¼Œæ²’é—œä¿‚çš„ğŸ˜‚
        </p>
      </div>
      <div class="grid gap-2 mt-2 hidden" id="disagree-section">
        <div class="flex gap-2 items-center justify-center">
          <span class="text-xl">æ²’é—œä¿‚çš„ï½ç¥ä½ æœ‰ç¾å¥½çš„ä¸€å¤©ï¼ï¼ï¼ğŸ˜‚</span>
        </div>
      </div>
      <div class="flex gap-7">
        <Button id="agree" className="text-lg"
          ><FaCheck /><span class="ml-1">OK</span>
          <Button id="disagree" className="text-lg" variant="destructive"
            ><FaX /><span class="ml-1">No</span></Button
          >
        </Button>
      </div>
    </div>
  </section>

  <style>
    #cursor {
      color: black;
      animation: blink 1s linear infinite;
    }
    @keyframes blink {
      0% {
        opacity: 100%;
      }
      50% {
        opacity: 0%;
      }
    }
  </style>

  <script>
    const selfPortraitNormal = document.getElementById("self-normal");
    const selfPortraitLaugh = document.getElementById("self-laugh");
    const agreeBtn = document.getElementById("agree");
    const disagreeBtn = document.getElementById("disagree");
    const introduction = document.getElementById("introduction");
    const agreeSection = document.getElementById("agree-section");
    const disagreeSection = document.getElementById("disagree-section");

    import JSConfetti from "js-confetti";

    const jsConfetti = new JSConfetti();

    agreeBtn?.addEventListener("click", () => {
      selfPortraitNormal?.classList.add("hidden");
      selfPortraitLaugh?.classList.remove("hidden");
      introduction?.classList.add("hidden");
      agreeSection?.classList.remove("hidden");
      disagreeSection?.classList.add("hidden");
      jsConfetti.addConfetti();
    });
    disagreeBtn?.addEventListener("click", () => {
      selfPortraitLaugh?.classList.add("hidden");
      selfPortraitNormal?.classList.remove("hidden");
      disagreeSection?.classList.remove("hidden");
      agreeSection?.classList.add("hidden");
    });

    const phrases = [
      "ä¸æ˜¯æ€ªäºº",
      "ä¸èŠ±å¿ƒï¼",
      "é —æœ‰å¥½å¥‡å¿ƒï½",
      "èªªè©±å¾ˆreal",
      "å¸¸å¸¸æ”¾ç©º...",
    ];
    const typewriter = document.getElementById("typewriter") as HTMLElement;
    const sleep = async (ms: number): Promise<void> => {
      return new Promise((resolve) => setTimeout(resolve, ms));
    };
    const sleepTime = 1000;
    let currentPhraseIndex = 0;
    const typeLoop = async () => {
      while (true) {
        let currentWord = phrases[currentPhraseIndex];
        for (let i = 0; i < currentWord.length; i++) {
          typewriter.innerText = currentWord.substring(0, i + 1);
          await sleep(200);
        }
        await sleep(sleepTime);
        for (let i = currentWord.length; i > 0; i--) {
          typewriter.innerText = currentWord.substring(0, i - 1);
          await sleep(200);
        }
        currentPhraseIndex += 1;
        if (currentPhraseIndex === phrases.length) {
          currentPhraseIndex = 0;
        }
      }
    };
    typeLoop();
  </script>
</BaseLayout>
