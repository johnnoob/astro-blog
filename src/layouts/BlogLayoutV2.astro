---
// astro components
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/Blog/PostCard.astro";
// react components
import PostSection from "@/components/BlogV2/PostSection.tsx";
import FilterSection from "@/components/BlogV2/FilterSection.tsx";
import Sidebar from "@/components/Blog/Sidebar";
// content collection
import { getCollection } from "astro:content";
import { type CollectionEntry } from "astro:content";
// nano store
import { useStore } from "@nanostores/react";

const posts = await getCollection(
  "posts",
  (post) => post.data.isDraft === false
);
// 將非同步post.render()的結果取出minutes
const fetchPostDetails = async () => {
  const details = await Promise.all(
    posts.map(async (post) => {
      console.log(post.render);
      const renderedPost = await post.render();
      return {
        ...post,
        minutes: renderedPost.remarkPluginFrontmatter.minutes,
      };
    })
  );
  return details;
};
const augmentedPosts = await fetchPostDetails();
---

<BaseLayout pageTitle="BlogV2">
  <FilterSection allPosts={augmentedPosts} client:load />
  <PostSection allPosts={augmentedPosts} client:load />
</BaseLayout>
